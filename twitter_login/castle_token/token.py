import random
import time

from .create4 import make_time_token
from .create5 import encode_to_4dig_hex
from .create8 import encode_3_arrs
from .func2 import func2
from .func3 import func3
from .func4 import func4
from .utils import n_digit_hex
from .fingerprint.preset import preset1


class Fake:
    two = '00002719560587005602874513870080008e005603158700800080001587c6001d80c6001d1587451380008700158703800187001519155601874513870080008e00158700800087c6001d80c6001dd3c60000001dd7c600011d'
    eight = [[False, False, True, False, False, False, False, False, False, True, False, True, False, False, False], [16.694, None, 71.611, 273.6, 88.083, 8.428, 1297.9, 1297.9, 91, 4.95, 180.9, 52.6, None, None, 273.6, None, 64.1, None, 216.65, 7.15, 174.89, 5.11, 174.89, 5.11, 0, 0, 0, 0.746, None, None, None, None, 290.4, 1.3, 0, 0, 0, 0, 3, 1.14, 3.72, 1.33, 6.13, 4.31, 48.85, 48.85, 9.12, 9.12, 0.883379, 0.549743, 1.608797, 6.7, 1.8, 1148.2000000476837, 882028.9000000358, 0.520461, 0.26658, 0.544299, 0.338841, 0.064654, 6.460901, 0.07598, 2.371723, 0.064654, 6.463393, -0.1422, 13.0115, 0.1576, 9.8211, -0.2844, 100.2403, -0.2844, 196.7748, -0.1202, 196.7748, 26.7816, 17.0411, 14.923, 8.0228, 0.1158, 164.1192, 0.8896, 192.7402, 0.2166, 192.7402, 711, 1083, 1545.549, 1, 301, 366, 130, 388.40185375458753, 19.555, 0.251303, 3.883, 360, 73.44, 0.883376, 3.898749, 4.868254, 6.148094, 0.0647, 0.5205, 0.2453, 0.076, 0.654741, 0.675559, 0.442316, 0.969183, 12.3, 6.45, 1.9, 186.5, 15.455, 6.04, 1.098308, 0.699375, 1.439679, 1.519394, 0.538386, 1.469846, 35.848, 34.8147, 1.608797, 3.979, 170.393, 11.58, 0.434481, 0.499716, 1.64, 1.911, 170.393, 7.73, 13.853, 170.393, 11.58, 6.023, 14206, 23, 36, 748.6, 481.4, 12.3, 25.96, 0.5851, 1.4112, 0.6784, 3.084, 2.0888, 2.5954, 1.1158, 6.4634, 0.5033, 0.5899, 0.2659, 1.9887, 0.332, 0.2701, 0.1904, 0.6414, 171.512, 174.287, 164.468, 171.306, 47.36, 52.499, 47.36, 3.883, 180, 90, 90, 360, 90, 71.487, 72.937, 90, 1, 43, 7.11, 1, 301, 10.83, 3960, 5353, 3683, 434.27529, 262.417611, 9.350365, 19.714411, 1.654901, 0.213, 0.766, 1141.49, 469.89, 1000, 480, 88.083, 91, 4.95, 40.3, 112.3, 78876.691, 1788, 1594.4, 193.6, 402550.1, 78876.318, 1796, 1655.9, 140.1, 402523.6, 0.369006, 0.383143, 0.098904, 0.779136, 0.368843, 0.383143, 0.098904, 0.779136, 0.369006, 0.383143, 0.098904, 0.779136, 0.1125, 0.014583, 0, 0.022917, 0.014583, 0.027083, 0.06875, 0.004167, 0.039583, 0.016667, 0.010417, 0.0375, 0.00625, 0.129167, 0.3875, 0.108333, 460006.59999996424, 9, 9, 9, 9, 0, 0, 1, 3, 6, 0, 0, 9, 68.39999997615814, 4.599999964237213, 73.2333333293597, 13.392815241234036, 90.75999999046326, 95.87999999523163, 99.97599999904632, 8, 233.30000001192093, 57493.33749999851, 444572.39999997616, 143008.34000000946, 293790.36999999266, 414415.9939999794, 289.2999999821186, 46.69999998807907, 156474.8740227551, 2.1175112757460024, 2.365815755320459, 8, 215.25, 37.80000001192093, 57418.4375, 156469.45108675282, 0, 0, 0, 0, 0, 0, 0, 0, 8, 3.456619426414826, 2.8434934982601625, 1.7752568586260358, 7, 0.07534918832128719, 3.1534263203351554, 6, 5.960267322448679, 256635.2081123522, 0.019564936676997026, 3.456619426414826, 0.01739331970421835, 18035.200000047684, 477981.90000003576, 459946.6999999881, 0, 0, -0.17856693295452156, -0.2147307110467625, 0.1707428626130799, 2.7216175095550708, 0.16142412717236626, 0.46259926097588, 2.986928104575115, 1.3333333333333333, 2, 2, 2, 0.8637453263606799, 0, 310.60000002384186, 0.625, 229169.5, 270.14999997615814, 0, 228899.35000002384, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 0.699999988079071, 0.8111111058129205, 0.5861835122651213, 9, 1.5999999642372131, 1.6555555529064603, 0.7568208306886548, 0, 0, 0, 0, 0, 19.3359375, 0.0174824322750198, 25.121720616814354, 0.6386990315733069, 0.940712376223526, 0.10981503347887668, 0.03333883821153735, 0.33543405275928206, 0.14987497303494607, 0.33323696316003015, 0.125, -0.9415357058616642, 100, 15386.675000002697, 0.05801650871316872, 2.4579439909665157, -0.17856693295452156, 0.1707428626130799, 0.4250015657988138, 1, 0.6131471927654584, 0.33193904958829706, 5, 1, 0, 0, 0, 1, 0, 1.5555555555555556, 0.5270462766947299, 1, 0, 0, 0, 6, 3.720341585895415, 3.77884317612048, 0.4606917689463927, 5, 0.10548886364980196, 0.9578714755288975, 4, 2.0180788611469813, 6, 270.14999997615814, 27.55000001192093, 267.9499999980132, 32.73424812176135, 59.89999997615814, 101, 0, 0, 0, 0, 0, 0, 402833, 704610.83333334, 862779.6999999881, 210.5, 402.54444444841806, 615.5999999642372, 121.69999998807907, 372.9222222301695, 540.6999999880791, 5000, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5000, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [200, 9, 14, 0, 9, 0, 0, 63, 0, 0, 2]]


class CastleToken:
    def __init__(self, init_time, cuid, fingerprint = None):
        self.init_time = init_time
        self.fingerprint = fingerprint or preset1(init_time)
        self.cuid = cuid
        self.random_value = random.randint(0, 15)

    def create_token(self, log1 = None, log2 = None):
        zero = random.randint(0, 255)
        one = 5
        two = log1 or Fake.two
        three = n_digit_hex(zero, 2)
        four = make_time_token(self.init_time, self.random_value)
        five = encode_to_4dig_hex(one)
        six = self.fingerprint
        seven = None
        eight = encode_3_arrs(*(log2 or Fake.eight))
        data = [zero, one, two, three, four, five, six, seven, eight]

        v1 = make_time_token(int(time.time()*1000), random.randint(0, 15))
        v2 = [v1, data[2]]
        v3 = func2(v2, data, self.cuid)
        return func4(func3(v3), data)
